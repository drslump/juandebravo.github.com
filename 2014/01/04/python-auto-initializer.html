<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Building an automatic initializer in python - juandebravo's personal blog</title>
  <meta name="description" content="juandebravo's personal blog - Personal thoughts about technology (@juandebravo)">
  <meta name="author" content="Juan de Bravo">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link href="http://feeds.feedburner.com/juandebravo" rel="alternate" title="juandebravo's personal blog" type="application/atom+xml">
  <link rel="author" href="/humans.txt">

  <link rel="stylesheet" href="/css/emoji.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/disqus.css">

  <script src="/js/libs/modernizr-2.0.6.min.js"></script>
</head>

<body>
  <div class='main_container'>
    <div class="title">
      <h1>
        <a href="/index.html">juandebravo's personal blog</a>
      </h1>
    </div>
    <div class="menu">
      <ul>
  
    
    
    <li class="item active">
      <a href="/index.html">Dev Blog</a>
    </li>
  
    
    
    <li class="item ">
      <a href="/open_source.html">Open Source</a>
    </li>
  
    
    
    <li class="item ">
      <a href="/about_me.html">About me</a>
    </li>
  
</ul>
    </div>
    <div class="container">

      <header>
  <h2><a class="fadedlink" href="/" title="Home">&laquo;</a> Building an automatic initializer in python <small>04 Jan 2014</small></h2>

  <nav>
    <ul class="clearfix">
    
      <li><a href="/tag/python.html">python</a></li>
    
      <li><a href="/tag/scala.html">scala</a></li>
    
    </ul>
  </nav>
</header>

<div id="post" role="main">
  <p>One of the cool things of Scala is that, in general, you don’t need to write a lot of boilerplate while doing things in the “normal way”.</p>

<p>As an example, while defining a class which constructor requires one or more arguments, there’s no need to assign the parameters to instance attributes, this is done out of the box by the compiler while creating the Java code:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala">class Foo(val x: String, val y: String)

val value = new Foo(&quot;bar&quot;, &quot;bazz&quot;)
println(value.x)
//&gt; bar</code></pre></figure>

<p>Python, like many other languages, does not behave that way, therefore you must assign the attributes to instance variables. Someone would argue that this is indeed the pythonic way to work, <a href="http://www.python.org/dev/peps/pep-0020/">making things as explicit as possible</a>. Letting aside that the method <a href="http://docs.python.org/2/reference/datamodel.html#object.__init__">__init__</a> is not a constructor, you can do the assigment with the following snippet of code:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">class Foo(object):

    def __init__(self, x, y):
        self.x = x
        self.y = y

value = Foo(&quot;bar&quot;, &quot;bazz&quot;)
print value.x
// bar</code></pre></figure>

<p>It turns out that a high percentage of the time, the only thing you may need to do in your __init__ methods is assigning the parameters to instance variables.  Being a common behavior, it seems to me like a nice chance to build a
<a href="2012/07/24/why-python-rocks_and_two/">decorator</a> :smile_cat:. Here it goes:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">import inspect

def autoinit(fn):
    co_varnames = fn.func_code.co_varnames
    kwa_defaults = inspect.getargspec(fn).defaults

    def _wrap(*args, **kwargs):
        self, nargs = args[0], args[1:]
        names = co_varnames[1:len(nargs)+1]
        kwa_keys = co_varnames[len(nargs)+1:]
        nargs = dict((k, nargs[names.index(k)]) for k in names)
        # Add the keyword arguments
        for k in kwa_keys:
            nargs[k] = kwargs[k] if k in kwargs else kwa_defaults[kwa_keys.index(k)]

        # Set the values to the instance attributes
        for k, v in nargs.iteritems():
            setattr(self, k, v)

        return fn(*args, **kwargs)

    return _wrap</code></pre></figure>

<p>The function that builds the decorator (autoinit) is doing simple things:</p>

<ul>
  <li>retrieve the parameter names and the default keyword parameter values</li>
  <li>build a function, which is the value returned by the function autoinit, which will inspect both args and kwargs while creating a new instance object, retrieve the actual value for every parameter, and assign them to instance attributes.</li>
</ul>

<p>An usage example:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">class Foo(object):

    @autoinit
    def __init__(self, x, y, a=10, b=100):
        pass

f = Foo(1, 2, 4)

print f.x, f.y, f.a, f.b
// 1 2 4 100</code></pre></figure>



  <p class="back">&laquo; <a href="/">Home</a></p>
</div>

<!--h2>Related Posts</h2>
<ul class="posts_list">
  
    <li class="post">
  <span class="left_title">22 Jan 2017</span>
  <a href="/2017/01/22/docker-insecure-registry" title="Docker and how to get access to insecure registries">Docker and how to get access to insecure registries</a>
</li>
  
    <li class="post">
  <span class="left_title">23 Nov 2015</span>
  <a href="/2015/11/23/webrtc-adapter-vagrant-box" title="A virtual machine for WebRTC development">A virtual machine for WebRTC development</a>
</li>
  
    <li class="post">
  <span class="left_title">06 Jul 2015</span>
  <a href="/2015/07/06/demystifying-coroutines-in-python" title="Demystifying coroutines in python">Demystifying coroutines in python</a>
</li>
  
</ul-->

<hr/>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'juandebravo'; // required: replace example with your forum shortname
    //var disqus_developer = 1; // developer mode is on, for testing locally

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


      <footer>
        <span class="author_info">
          <a href="/about_me.html">Juan de Bravo</a>
        </span>
        <a class="fadedlink footer_link github" href="https://github.com/juandebravo">
          @github
        </a>
        <a class="fadedlink footer_link twitter" href="https://twitter.com/juandebravo">
          @twitter
        </a>
        <a class="fadedlink footer_link linkedin" href="http://linkedin.com/in/juandebravo">
          @linkedin
        </a>
        <a class="fadedlink" href="mailto:juandebravo@gmail.com">
          <img src="/gfx/gmail-logo.png" alt="@gmail">
        </a>
      </footer>
    </div>
  </div>

  <script>
    window._gaq = [['_setAccount','UA-32824811-1'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({
      load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
    });
  </script>

  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
</body>
</html>
