<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Things I like using python (part II) - juandebravo's personal blog</title>
  <meta name="description" content="juandebravo's personal blog - Personal thoughts about technology (@juandebravo)">
  <meta name="author" content="Juan de Bravo">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link href="http://feeds.feedburner.com/juandebravo" rel="alternate" title="juandebravo's personal blog" type="application/atom+xml">
  <link rel="author" href="/humans.txt">

  <link rel="stylesheet" href="/css/emoji.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/disqus.css">

  <script src="/js/libs/modernizr-2.0.6.min.js"></script>
</head>

<body>
  <div class='main_container'>
    <div class="title">
      <h1>
        <a href="/index.html">juandebravo's personal blog</a>
      </h1>
    </div>
    <div class="menu">
      <ul>
  
    
    
    <li class="item active">
      <a href="/index.html">Dev Blog</a>
    </li>
  
    
    
    <li class="item ">
      <a href="/open_source.html">Open Source</a>
    </li>
  
    
    
    <li class="item ">
      <a href="/about_me.html">About me</a>
    </li>
  
</ul>
    </div>
    <div class="container">

      <header>
  <h2><a class="fadedlink" href="/" title="Home">&laquo;</a> Things I like using python (part II) <small>24 Jul 2012</small></h2>

  <nav>
    <ul class="clearfix">
    
      <li><a href="/tag/python.html">python</a></li>
    
    </ul>
  </nav>
</header>

<div id="post" role="main">
  <h1 id="introduction">Introduction</h1>

<p>Here it goes my second and last post on the “things that I like about coding in python” series in which was missing a small section on how cool these features (below) are:</p>

<ul>
  <li>Decorators</li>
  <li>Context managers</li>
  <li>Use blank spaces to define code blocks</li>
</ul>

<h1 id="decorators">Decorators</h1>
<p>A decorator is a function that takes at least an argument, a function object, and returns a single value, a function object. It’s commonly used to, taking advantage of python closures support, add new features to the original function object (the one received as argument).</p>

<p><a href="http://www.python.org/dev/peps/pep-0318/">Decorators were defined in PEP 318</a> as a way to ease the definition of class and static methods.</p>

<p>Before decorators reached python, the following excerpt was needed to create a class/static method:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">class Foo(object):
    
    def bar(self, name):
        return &quot;Hello {0} from my class method&quot;.format(name)

    def bazz(name):
        return &quot;Hello {0} from my static method&quot;.format(name)
    
    # Convert bar from instance to class method
    bar = classmethod(bar)
    
    # Create a static method
    bazz = staticmethod(bazz)

if __name__ == &#39;__main__&#39;:
    print Foo.bar(&#39;John Doe&#39;)
    print Foo.bazz(&#39;John Doe&#39;)</code></pre></figure>

<p>Reminder: the main difference between static and class methods is that a class method can be overriden by a child, which is not true for a static method. Also a class method needs the class object as first parameter in the method definition. At this point, I don’t find a good reason to define a static method though.</p>

<p>Using decorators and its syntax sugar (the <strong>@</strong> symbol), the previous excerpt can be re-written to:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">class Foo(object):
    
    # Define bar as a class method
    # As first parameter we could use &#39;self&#39;, but the facto standard is to use &#39;cls&#39; while
    # defining class methods
    @classmethod
    def bar(cls, name):
        return &quot;Hello {0} from my class method&quot;.format(name)

    # Define bazz as a static method
    @staticmethod
    def bazz(name):
        return &quot;Hello {0} from my static method&quot;.format(name)
    
if __name__ == &#39;__main__&#39;:
    print Foo.bar(&#39;John Doe&#39;)
    print Foo.bazz(&#39;John Doe&#39;)</code></pre></figure>

<p>The best blog post explaining decorators I’ve found so far is <a href="http://pythonconquerstheuniverse.wordpress.com/2012/04/29/python-decorators">this one from Steve Ferg</a>. I find decorators quite useful when you need transversal functionalities in your code. A set of examples can be found in <a href="http://wiki.python.org/moin/PythonDecoratorLibrary">wiki.python.org</a>.</p>

<h3 id="example">Example</h3>

<p>The following code creates a decorator that dumps the arguments that a function/method receives when executed. The base of that code is taken from <a href="http://wiki.python.org/moin/PythonDecoratorLibrary#Easy_Dump_of_Function_Arguments">wiki.python.org#Easy_Dump_Of_Function_Arguments</a>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"># decorator_utils.py

import logging

logging.basicConfig(level=logging.DEBUG)

def dump_args(func):
    # get function arguments name
    argnames = func.func_code.co_varnames[:func.func_code.co_argcount]

    # get function name
    fname = func.func_name
    logger = logging.getLogger(fname)

    def echo_func(*args, **kwargs):
        &quot;&quot;&quot;
        Log arguments, including name, type and value
        &quot;&quot;&quot;
        def format_arg(arg):
            return &#39;%s=%s&lt;%s&gt;&#39; % (arg[0], arg[1].__class__.__name__, arg[1])
        logger.debug(&quot; args =&gt; {0}&quot;.format(&#39;, &#39;.join(
            format_arg(entry) for entry in zip(argnames, args) + kwargs.items())))
        return func(*args, **kwargs)

    return echo_func

# example.py

from decorator_utils import dump_args

class UserModel(object):
    &quot;&quot;&quot;
    User model object
    &quot;&quot;&quot;

    def __init__(self, user_id=None):
        self.user_id = user_id

    @classmethod
    @dump_args
    def find_by_id(cls, user_id):
        pass

    @dump_args
    def update(self, **kwargs):
        pass

    def __str__(self):
        return unicode(self).encode(&#39;utf-8&#39;)

    def __unicode__(self):
        return str(self.user_id)


@dump_args
def f1(user_id, arg1, arg2, **kwargs):
    pass


if __name__ == &#39;__main__&#39;:
    UserModel.find_by_id(&#39;foo&#39;)

    u = UserModel(&#39;879234-32423423&#39;)
    u.update(name=&quot;John&quot;, surname=&quot;Doe&quot;)
    f1(u, 2, 3)

    f1(u, 2, 3, foo=&#39;bazz&#39;, bar=23)</code></pre></figure>

<p>The execution of the previous code generates the following output:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">λ python example.py

DEBUG:find_by_id: args =&gt; cls=type&lt;&lt;class &#39;__main__.UserModel&#39;&gt;&gt;, user_id=str&lt;foo&gt;
DEBUG:update: args =&gt; self=UserModel&lt;879234-32423423&gt;, surname=str&lt;Doe&gt;, name=str&lt;John&gt;
DEBUG:f1: args =&gt; user_id=UserModel&lt;879234-32423423&gt;, arg1=int&lt;2&gt;, arg2=int&lt;3&gt;
DEBUG:f1: args =&gt; user_id=UserModel&lt;879234-32423423&gt;, arg1=int&lt;2&gt;, arg2=int&lt;3&gt;, foo=str&lt;bazz&gt;, bar=int&lt;23&gt;</code></pre></figure>

<p>As it’s shown above (method <em>find_by_id</em>), you can use more than one decorator in a function/method (and are executed bottom-up).</p>

<h1 id="context-managers-with-statement">Context managers (<strong>with</strong> statement)</h1>

<p>A context manager allows you to create and manage a run time context. It is created when starting a <strong>with</strong> statement, it’s available during the code execution inside the <em>with</em> block, and is exited at the end of the <em>with</em> code. The most commonly used scenario is while <strong>allocating resources</strong>: a context manager ensures you use the resource only while it’s actually required and deallocates it when it should not be used anymore (of course python needs you to write the code properly for that if you are defining your own context manager).</p>

<p>The basic example using python native library to handle a file object:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">with open(&#39;/var/log/events.log&#39;, &#39;w&#39;) as f:
    n = f.write(&quot;New user created&quot;)</code></pre></figure>

<p>The file <em>/var/log/events.log</em> is opened when entering into the context manager, and closed when the code block is finished. You don’t need to catch exceptions, close the file, etc.</p>

<p>To create a context manager you need to define a class that implements two methods, <strong>__enter__</strong> and <strong>__exit__</strong>. In the following code I’m creating a context manager, <em>user</em>, that retrieves an object from an external source and stores it back if updated:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">class User(dict):
    &quot;&quot;&quot;
    Database object
    &quot;&quot;&quot;
    def __init__(self, user_id, **kwargs):
        self.user_id = user_id
        self.update(kwargs)

    def has_changed(self):
        # logic to check if any user property has been updated
        return True

class user(object):
    &quot;&quot;&quot;
    Context manager for a User object
    &quot;&quot;&quot;

    def __init__(self, user_id):
        self.user_id = user_id

    def __enter__(self):
        &quot;&quot;&quot;
        This code block is executed while entering a context manager
        &quot;&quot;&quot;
        # mock that returns always a basic User
        self.user = User(self.user_id, name=&quot;John&quot;, surname=&quot;Doe&quot;)
        return self.user

    def __exit__(self, _type, value, tb):
        &quot;&quot;&quot;
        This code block is executed at context manager exit
        &quot;&quot;&quot;
        if self.user.has_changed():
            # here the save logic
            pass

if __name__ == &#39;__main__&#39;:
    with user(&#39;00000-11111&#39;) as u:
        u[&#39;name&#39;] = &#39;Johnny&#39;</code></pre></figure>

<p>Switching to ruby, something similar can be achieved with the following snippet:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">class User &lt; Hash
  attr_reader :user_id
  
  def initialize(user_id, params = {})
    @user_id = user_id
    self.update(params) if params.length &gt; 0
    if block_given?
      yield self
      if self.has_changed?
        # here the save logic
      end
    end
  end
  
  def has_changed?
    # logic to check if any user property has been updated
    return True
  end
  
  class &lt;&lt; self
    def find!(user_id)
      # mock that returns always a basic User instance
      if block_given?
        User.new(user_id, {name:&quot;John&quot;, surname:&quot;Doe&quot;}, &amp;Proc.new)
      else
        User.new(user_id, {name:&quot;John&quot;, surname:&quot;Doe&quot;})
      end
    end
  end
end

User.find!(&#39;0000-1111&#39;) do |u|
  u[:name] = &quot;Johnny&quot;
end</code></pre></figure>

<h1 id="use-blank-spaces-to-define-code-blocks">Use blank spaces to define code blocks</h1>
<p>Not too much to say about this. I thinks it increases readability.</p>

<h1 id="conclusion">Conclusion</h1>
<p>I hope you’ve found these articles interesting. I’m sure some good points, like functions being first-class citizens or the collections and functools modules, are missing but at this point I just wanted to highlight my five coolest features. Let me know which are yours so my top five list could easily be “re-prioritized” :-)</p>


  <p class="back">&laquo; <a href="/">Home</a></p>
</div>

<!--h2>Related Posts</h2>
<ul class="posts_list">
  
    <li class="post">
  <span class="left_title">22 Jan 2017</span>
  <a href="/2017/01/22/docker-insecure-registry" title="Docker and how to get access to insecure registries">Docker and how to get access to insecure registries</a>
</li>
  
    <li class="post">
  <span class="left_title">23 Nov 2015</span>
  <a href="/2015/11/23/webrtc-adapter-vagrant-box" title="A virtual machine for WebRTC development">A virtual machine for WebRTC development</a>
</li>
  
    <li class="post">
  <span class="left_title">06 Jul 2015</span>
  <a href="/2015/07/06/demystifying-coroutines-in-python" title="Demystifying coroutines in python">Demystifying coroutines in python</a>
</li>
  
</ul-->

<hr/>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'juandebravo'; // required: replace example with your forum shortname
    //var disqus_developer = 1; // developer mode is on, for testing locally

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


      <footer>
        <span class="author_info">
          <a href="/about_me.html">Juan de Bravo</a>
        </span>
        <a class="fadedlink footer_link github" href="https://github.com/juandebravo">
          @github
        </a>
        <a class="fadedlink footer_link twitter" href="https://twitter.com/juandebravo">
          @twitter
        </a>
        <a class="fadedlink footer_link linkedin" href="http://linkedin.com/in/juandebravo">
          @linkedin
        </a>
        <a class="fadedlink" href="mailto:juandebravo@gmail.com">
          <img src="/gfx/gmail-logo.png" alt="@gmail">
        </a>
      </footer>
    </div>
  </div>

  <script>
    window._gaq = [['_setAccount','UA-32824811-1'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({
      load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
    });
  </script>

  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
</body>
</html>
